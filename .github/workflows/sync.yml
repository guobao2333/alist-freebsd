name: Check and Sync

on:
  schedule:
    - cron: '0 16 */1 * *' # Runs daily at 4PM
  workflow_dispatch:

jobs:
  tests:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Compare versions
        run: |
          export REMOTEVERSION=$(curl -s https://api.github.com/repos/alist-org/alist/releases/latest | jq -r '.tag_name')
          export LOCALVERSION=$(curl -s --location --fail --show-error "https://api.github.com/repos/${{ github.repository }}/releases/latest" | jq -r '.tag_name')
          echo "‚òÅÔ∏èRemote Version: $REMOTEVERSION | üì•Local Version: $LOCALVERSION"
        SYNCED: ${{( $LOCALVERSION == $REMOTEVERSION ) ? 'true' : 'false' }}

      - name: Build latest version
        if: ${{ env.SYNCED }}
          run: echo "No need to build, it's already the latest version"
        else:
          run: echo "Preparing to build..."
          uses: actions/github-script@v7
          with:
            script: |
              await github.rest.actions.createWorkflowDispatch({
                owner: context.repo.owner,
                repo: context.repo.repo,
                workflow_id: 'build.yml',
                ref: 'main'
              })
